@using Auger.Models
@model SubmissionViewModel

<div class="row">
  <div class="col-xs-4 col-sm-3 col-md-2" style="padding-right:0;padding-left:10px;">
    <div class="panel panel-info">
      <div class="panel-heading">
        Files and Folders
      </div>
      <div id="folder-div" class="panel-body full-height" style="padding:0;">
        <div class="btn-group-xs btn-group-vertical" style="width:100%;height:100%;overflow:auto;">
          @ShowFolder(Model.Folder)
        </div>
      </div>
    </div>
  </div>
  <div class="col-xs-8 col-sm-9 col-md-10" style="padding-right:10px">
    <div class="panel panel-info">
      <div class="panel-heading">
        Selected File: <span id="file-name"></span>
      </div>
      <div class="panel-body" style="padding:0;">
        <ul class="nav nav-tabs" id="viewTabs">
          <li class="active"><a data-toggle="tab" id="tabBrowser" href="#paneBrowser">Browser</a></li>
          <li class=""><a data-toggle="tab" id="tabSource" href="#paneSource">Source</a></li>
          <li class="pull-right btn-group btn-group-sm" style="padding:4px;">
            <a class="btn btn-primary" role="button" id="buttonOpenInNewWindow" target="_blank" href="#"><i class="fa fa-external-link"></i>&nbsp;Pop Out</a>
          </li>
        </ul>
        <div class="tab-content" style="padding:0;background-color:#fff;">
          <div class="tab-pane active" id="paneBrowser">
            <div class="full-height">
              <iframe id="browser" style="width:100%;height:100%;border:0;"></iframe>
            </div>
          </div>
          <div class="tab-pane" id="paneSource">
            <div class="full-height">
              <div id="editor" style="width:100%;height:100%;"></div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

@helper ShowFolder(SubmissionFolder folder, string path = "", int level = 0)
{
  foreach (var subfolder in folder.Folders)
  {
    var id = Guid.NewGuid().ToString();

    <a href="#@id" class="btn" role="button" data-toggle="collapse">
      <div class="text-left" style="overflow:hidden;text-overflow:ellipsis;">
        @for (int i = 0; i < level; i++)
        { <text>&nbsp;&nbsp;</text> }
        <i class="fa fa-folder-open"></i>&nbsp;@subfolder.Name
      </div>
    </a>
    <div class="collapse" id="@id">
      <div class="btn-group-xs btn-group-vertical" style="width: 100%;">
        @ShowFolder(subfolder, path + "/" + subfolder.Name, level + 1)
      </div>
    </div>
  }
  foreach (var file in folder.Files)
  {
    var first = path.Length == 0 && file == folder.Files.FirstOrDefault();
    var id = first ? "buttonDefaultFile" : "";

    <a href="@(path + "/" + file.Name)" class="btn text-left file-button" role="button" id="@id">
      <div class="text-left" style="overflow:hidden;text-overflow:ellipsis;">
        @for (int i = 0; i < level; i++)
        { <text>&nbsp;&nbsp;</text> }
        <i class="fa fa-file"></i>&nbsp;@file.Name
      </div>
    </a>
  }
}
